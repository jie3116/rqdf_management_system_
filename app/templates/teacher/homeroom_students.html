{% extends "base.html" %}
{% block content %}
<div class="container-fluid">
    <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <h1 class="h3 mb-0 text-gray-800">Data Perwalian</h1>
        <span class="badge bg-warning text-dark px-3 py-2 fs-6"><i class="fas fa-chalkboard-teacher me-2"></i>Kelas: {{ homeroom_class.name }}</span>
    </div>

    {% if homeroom_classes and homeroom_classes|length > 1 %}
    <form method="GET" class="mb-3">
        <label class="small fw-bold text-muted">Pilih Kelas Perwalian</label>
        <select name="class_id" class="form-select" onchange="this.form.submit()">
            {% for cls in homeroom_classes %}
            <option value="{{ cls.id }}" {% if cls.id == homeroom_class.id %}selected{% endif %}>{{ cls.name }}</option>
            {% endfor %}
        </select>
    </form>
    {% endif %}

    <div class="card shadow mb-4">
        <div class="card-header py-3"><h6 class="m-0 fw-bold text-primary">Daftar Santri</h6></div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-bordered table-striped table-hover" width="100%">
                    <thead class="bg-dark text-white text-center"><tr><th>NIS</th><th>Nama Lengkap</th><th>L/P</th><th>No. HP Wali</th><th>Aksi (Cetak)</th></tr></thead>
                    <tbody>
                        {% for student in students %}
                        <tr>
                            <td class="text-center">{{ student.nis }}</td><td class="fw-bold">{{ student.full_name }}</td><td class="text-center">{{ student.gender.value if student.gender else '-' }}</td><td>{{ student.parent.phone if student.parent else '-' }}</td>
                            <td class="text-center">
                                <a class="btn btn-primary btn-sm" href="{{ url_for('teacher.print_report_card', student_id=student.id) }}" target="_blank"><i class="fas fa-file-alt me-1"></i> Raport</a>
                                <a class="btn btn-info btn-sm" href="{{ url_for('teacher.print_attachment', student_id=student.id) }}" target="_blank"><i class="fas fa-list-alt me-1"></i> Lampiran</a>
                            </td>
                        </tr>
                        {% else %}
                        <tr><td colspan="5" class="text-center text-muted">Belum ada siswa di kelas ini.</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="card shadow mb-4">
        <div class="card-header py-3"><h6 class="m-0 fw-bold text-success">Daftar Peserta Majlis Ta'lim</h6></div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-bordered table-striped table-hover" width="100%">
                    <thead class="bg-dark text-white text-center"><tr><th>Nama Peserta</th><th>No. WhatsApp</th><th>Pekerjaan</th><th>Alamat</th></tr></thead>
                    <tbody>
                        {% for participant in majlis_participants %}
                        <tr>
                            <td class="fw-bold">{{ participant.full_name }}</td>
                            <td class="text-center">{{ participant.phone or '-' }}</td>
                            <td>{{ participant.job or '-' }}</td>
                            <td>{{ participant.address or '-' }}</td>
                        </tr>
                        {% else %}
                        <tr><td colspan="4" class="text-center text-muted">Belum ada peserta majlis di kelas ini.</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}
