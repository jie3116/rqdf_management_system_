<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Raport - {{ student.full_name }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        /* CSS KHUSUS CETAK */
        body {
            font-family: 'Times New Roman', serif;
            color: #000;
            background: #fff;
            -webkit-print-color-adjust: exact; /* Agar background warna (abu-abu) ikut tercetak */
        }

        /* Garis Tabel Hitam Pekat */
        .table-bordered { border: 1px solid #000 !important; }
        .table-bordered th, .table-bordered td { border: 1px solid #000 !important; }

        /* Kop Surat */
        .kop-surat {
            border-bottom: 3px double #000;
            padding-bottom: 15px;
            margin-bottom: 30px;
        }

        /* --- PENTING: MENYEMBUNYIKAN TOMBOL SAAT PRINT --- */
        @media print {
            .no-print {
                display: none !important;
                visibility: hidden !important;
                opacity: 0 !important;
            }
            @page {
                margin: 2cm; /* Margin kertas */
                size: portrait;
            }
        }
    </style>
</head>
<body class="p-4">

    <div class="container">
        <div class="d-flex justify-content-end mb-4 no-print">
            <button onclick="window.print()" class="btn btn-primary fw-bold me-2">
                <i class="fas fa-print"></i> Cetak Raport PDF
            </button>
            <button onclick="window.close()" class="btn btn-secondary">
                Tutup
            </button>
        </div>

        <div class="row align-items-center kop-surat">
            <div class="col-2 text-center">
                <img src="{{ url_for('static', filename='img/rqdf-logo.png') }}" alt="LOGO" style="width: 90px;">
            </div>
            <div class="col-10 text-center">
                <h3 class="fw-bold mb-0 text-uppercase">YAYASAN RUMAH QUR'AN CIANJUR</h3>
                <h4 class="fw-bold mb-0 text-uppercase">PESANTREN RUMAH QUR'AN DARUL FALAH</h4>
                <p class="mb-0 small">Kp. Buniwangi Keluarahan Bojongherang Cianjur</p>
            </div>
        </div>

        <table class="table table-borderless table-sm mb-4">
            <tr>
                <td width="200">Nama Peserta Didik</td>
                <td width="10">:</td>
                <td class="fw-bold">{{ student.full_name }}</td>
                <td width="200">Tahun Pelajaran</td>
                <td width="10">:</td>
                <td>{{ academic_year.name if academic_year else '-' }}</td>
            </tr>
            <tr>
                <td>Nomor Induk / NISN</td>
                <td>:</td>
                <td>{{ student.nis }} / {{ student.nisn }}</td>
                <td>Kelas</td>
                <td>:</td>
                <td>{{ student.current_class.name }}</td>
            </tr>
        </table>

        <h5 class="fw-bold mb-3 small">A. CAPAIAN HASIL BELAJAR</h5>
        <table class="table table-bordered border-dark table-sm align-middle">
            <thead class="text-center bg-light">
                <tr>
                    <th rowspan="2" style="width: 5%">No</th>
                    <th rowspan="2" style="width: 30%">Mata Pelajaran</th>
                    <th rowspan="2" style="width: 8%">KKM</th>
                    <th colspan="2">Nilai Pengetahuan</th>
                    <th rowspan="2" style="width: 40%">Deskripsi Kemajuan Belajar</th>
                </tr>
                <tr>
                    <th style="width: 8%">Angka</th>
                    <th style="width: 8%">Predikat</th>
                </tr>
            </thead>
            <tbody>
                {% if final_report %}
                    {% for item in final_report %}
                    <tr>
                        <td class="text-center">{{ loop.index }}</td>
                        <td class="fw-bold px-2">{{ item.subject }}</td>
                        <td class="text-center">{{ item.kkm }}</td>

                        <td class="text-center fw-bold fs-6">{{ item.final }}</td>
                        <td class="text-center fw-bold">{{ item.predikat }}</td>

                        <td class="px-2 small fst-italic" style="font-size: 11pt;">
                            {% if item.predikat == 'A' %}
                                Sangat baik dalam menguasai materi, pertahankan prestasinya.
                            {% elif item.predikat == 'B' %}
                                Baik dalam memahami materi, tingkatkan ketelitian dalam latihan.
                            {% elif item.predikat == 'C' %}
                                Cukup memahami materi, perlu lebih banyak latihan dan remedial.
                            {% else %}
                                Kurang, mohon bimbingan lebih intensif di rumah.
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr><td colspan="6" class="text-center py-4">Belum ada data nilai.</td></tr>
                {% endif %}
            </tbody>
        </table>
        </table>

        <h5 class="fw-bold mb-2 small mt-4">B. KETIDAKHADIRAN</h5>
        <div style="width: 400px;"> <table class="table table-bordered border-dark table-sm">
                <tr>
                    <td width="60%">Sakit</td>
                    <td width="40%" class="text-center"> {{ attendance_stats.sakit }} hari</td>
                </tr>
                <tr>
                    <td>Izin</td>
                    <td class="text-center"> {{ attendance_stats.izin }} hari</td>
                </tr>
                <tr>
                    <td>Tanpa Keterangan</td>
                    <td class="text-center"> {{ attendance_stats.alpa }} hari</td>
                </tr>
            </table>
        </div>

        <div class="row mt-5">
            <div class="col-4 text-center">
                <br>Orang Tua / Wali<br><br><br><br>
                ( .................................... )
            </div>
            <div class="col-4"></div>
            <div class="col-4 text-center">
                Bandung, {{ academic_year.created_at.strftime('%d %B %Y') }}<br>
                Wali Kelas<br><br><br><br>
                <strong>{{ student.current_class.homeroom_teacher.full_name }}</strong><br>
                <small>NIP. {{ student.current_class.homeroom_teacher.nip or '..................' }}</small>
            </div>
        </div>

    </div>
</body>
</html>