<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Lampiran Nilai - {{ student.full_name }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Times New Roman', serif; color: #000; }
        .table-bordered { border: 1px solid #000 !important; }
        .table-bordered th, .table-bordered td { border: 1px solid #000 !important; }

        /* --- KUNCI PERBAIKAN DI SINI --- */
        @media print {
            .no-print, .no-print * {
                display: none !important;
                visibility: hidden !important;
                height: 0 !important;
            }
            /* Hilangkan header/footer default browser jika mengganggu */
            @page {
                margin: 1cm;
                size: portrait;
            }
        }
    </style>
</head>
<body class="p-5">

    <div class="container">
        <div class="d-flex justify-content-between mb-4 no-print">
            <h4 class="fw-bold text-muted">LAMPIRAN TRANSKRIP NILAI</h4>
            <div>
                <button onclick="window.print()" class="btn btn-primary"><i class="fas fa-print me-2"></i>Cetak Lampiran</button>
                <button onclick="window.close()" class="btn btn-secondary ms-2">Tutup</button>
            </div>
        </div>

        <div class="border-bottom border-dark mb-4 pb-2">
            <h5 class="fw-bold mb-0">LAPORAN SETORAN TAHFIDZ & BACAAN</h5>
            <small>Nama: {{ student.full_name }} | Kelas: {{ student.current_class.name if student.current_class else '-' }}</small>
        </div>

        <h6 class="fw-bold mt-3">A. Setoran Tahfidz</h6>
        <table class="table table-bordered border-dark table-sm table-striped mb-4">
            <thead class="text-center bg-light">
                <tr>
                    <th>No</th>
                    <th>Tanggal</th>
                    <th>Jenis</th>
                    <th>Materi</th>
                    <th>Nilai Angka</th>
                    <th>Predikat</th>
                </tr>
            </thead>
            <tbody>
                {% if tahfidz_records %}
                    {% for record in tahfidz_records %}
                    <tr>
                        <td class="text-center">{{ loop.index }}</td>
                        <td class="text-center">{{ record.date.strftime('%d/%m/%Y') if record.date else '-' }}</td>
                        <td class="text-center">{{ record.type.value if record.type else '-' }}</td>
                        <td>
                            {{ record.surah or '-' }}
                            {% if record.ayat_start and record.ayat_end %}
                                ({{ record.ayat_start }}-{{ record.ayat_end }})
                            {% endif %}
                        </td>
                        <td class="text-center fw-bold">{{ record.score if record.score is not none else '-' }}</td>
                        <td class="text-center">{{ record.quality or '-' }}</td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="6" class="text-center">Belum ada data setoran tahfidz.</td>
                    </tr>
                {% endif %}
            </tbody>
        </table>

        <h6 class="fw-bold mt-4">B. Setoran Bacaan</h6>
        <table class="table table-bordered border-dark table-sm table-striped">
            <thead class="text-center bg-light">
                <tr>
                    <th>No</th>
                    <th>Tanggal</th>
                    <th>Sumber</th>
                    <th>Materi</th>
                    <th>Nilai Angka</th>
                </tr>
            </thead>
            <tbody>
                {% if recitation_records %}
                    {% for record in recitation_records %}
                    <tr>
                        <td class="text-center">{{ loop.index }}</td>
                        <td class="text-center">{{ record.date.strftime('%d/%m/%Y') if record.date else '-' }}</td>
                        <td class="text-center">{{ record.recitation_source.value if record.recitation_source else '-' }}</td>
                        <td>
                            {% if record.recitation_source and record.recitation_source.name == 'QURAN' %}
                                {{ record.surah or '-' }}
                                {% if record.ayat_start and record.ayat_end %}
                                    ({{ record.ayat_start }}-{{ record.ayat_end }})
                                {% endif %}
                            {% else %}
                                {{ record.book_name or '-' }}
                                {% if record.page_start and record.page_end %}
                                    (Hal. {{ record.page_start }}-{{ record.page_end }})
                                {% endif %}
                            {% endif %}
                        </td>
                        <td class="text-center fw-bold">{{ record.score if record.score is not none else '-' }}</td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="5" class="text-center">Belum ada data setoran bacaan.</td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</body>
</html>
