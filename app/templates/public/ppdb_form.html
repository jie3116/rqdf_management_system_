
{% extends "base.html" %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card shadow border-0 border-top border-5 border-primary mb-4">
            <div class="card-body p-5">
                <div class="text-center mb-4">
                    <h1 class="fw-bold text-primary">Pendaftaran Program RQDF</h1>
                    <p class="text-muted lead">Tahun 2026/2027</p>
                </div>
            </div>
        </div>

        <form method="POST">
            {{ form.hidden_tag() }}

            <!-- STEP 1: Pilihan Program -->
            <div class="card shadow-sm border-0 mb-4">
                <div class="card-header bg-white py-3">
                    <h5 class="m-0 fw-bold text-primary">1. Pilihan Program</h5>
                </div>
                <div class="card-body p-4">
                    <div class="mb-3">
                        <label class="form-label fw-bold">{{ form.program_type.label.text }} <span class="text-danger">*</span></label>
                        {{ form.program_type(class="form-select form-select-lg bg-light border-primary", id="programSelector") }}

                        <!-- Info khusus Majelis Ta'lim -->
                        <div id="majlis_info" class="alert alert-success mt-3" style="display: none;">
                            <h6><i class="fas fa-mosque me-2"></i>Majelis Ta'lim RQDF</h6>
                            <ul class="mb-0 small">
                                <li><strong>100% GRATIS</strong> - Tidak ada biaya pendaftaran maupun SPP</li>
                                <li>Khusus untuk <strong>Ibu-ibu</strong> yang ingin belajar agama Islam</li>
                                <li>Jadwal: <strong>Rabu & Jumat pagi</strong> (09.00 - 11.00 WIB)</li>
                                <li>Materi: Tajwid, Tahfidz, Fiqh Wanita, Akhlak</li>
                            </ul>
                        </div>
                    </div>

                    <div id="group_formal_options">
                        <div class="row">
                            <div class="col-md-6 mb-3" id="div_jenjang">
                                <label class="form-label fw-bold">{{ form.education_level.label.text }}</label>
                                {{ form.education_level(class="form-select", id="educationSelector") }}
                            </div>
                            <div class="col-md-6 mb-3" id="div_jalur_beasiswa">
                                <label class="form-label fw-bold">Jalur Pendaftaran</label>
                                {{ form.scholarship_category(class="form-select", id="scholarshipSelector") }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- STEP 2: Data Diri -->
            <div class="card shadow-sm border-0 mb-4">
                <div class="card-header bg-white py-3">
                    <h5 class="m-0 fw-bold text-primary">2. Data Diri</h5>
                </div>
                <div class="card-body p-4">
                    <div class="mb-3">
                        <label class="form-label fw-bold">{{ form.full_name.label.text }} <span class="text-danger">*</span></label>
                        {{ form.full_name(class="form-control") }}
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label fw-bold">{{ form.place_of_birth.label.text }} <span class="text-danger">*</span></label>
                            {{ form.place_of_birth(class="form-control") }}
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label fw-bold">{{ form.date_of_birth.label.text }} <span class="text-danger">*</span></label>
                            {{ form.date_of_birth(class="form-control", type="date") }}
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label d-block fw-bold">Jenis Kelamin <span class="text-danger">*</span></label>
                        {% for subfield in form.gender %}
                            <div class="form-check form-check-inline">
                                {{ subfield(class="form-check-input") }}
                                {{ subfield.label(class="form-check-label") }}
                            </div>
                        {% endfor %}
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-bold">{{ form.address.label.text }} <span class="text-danger">*</span></label>
                        {{ form.address(class="form-control", rows="2") }}
                    </div>

                    <!-- Data khusus Majelis Ta'lim -->
                    <div id="majlis_personal_data" style="display: none;">
                        <div class="alert alert-info">
                            <strong>Data Kontak & Pekerjaan</strong>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold">{{ form.parent_phone.label.text }} <span class="text-danger">*</span></label>
                                {{ form.parent_phone(class="form-control", placeholder="08xxxxxxxxxx") }}
                                <small class="text-muted">Nomor WhatsApp Anda</small>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold">{{ form.personal_job.label.text }} <span class="text-danger">*</span></label>
                                {{ form.personal_job(class="form-control", placeholder="Contoh: Ibu Rumah Tangga") }}
                            </div>
                        </div>
                    </div>

                    <!-- Data optional untuk semua program -->
                    <div id="optional_data">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Nama Panggilan</label>
                                {{ form.nickname(class="form-control") }}
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Usia</label>
                                {{ form.age(class="form-control") }}
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">NIK (16 Digit)</label>
                                {{ form.nik(class="form-control", maxlength="16") }}
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">No. Kartu Keluarga</label>
                                {{ form.kk_number(class="form-control", maxlength="16") }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- STEP 3: Latar Belakang Pendidikan (Hidden untuk Majelis) -->
            <div class="card shadow-sm border-0 mb-4" id="education_background">
                <div class="card-header bg-white py-3">
                    <h5 class="m-0 fw-bold text-primary">3. Latar Belakang Pendidikan</h5>
                </div>
                <div class="card-body p-4">
                    <div class="row">
                        <div class="col-md-8 mb-3">
                            <label class="form-label fw-bold">{{ form.previous_school.label.text }}</label>
                            {{ form.previous_school(class="form-control") }}
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Kelas Terakhir</label>
                            {{ form.previous_school_class(class="form-control") }}
                        </div>
                    </div>
                </div>
            </div>

            <!-- STEP 4: Data Orang Tua (Hidden untuk Majelis) -->
            <div class="card shadow-sm border-0 mb-4" id="parent_data">
                <div class="card-header bg-white py-3">
                    <h5 class="m-0 fw-bold text-primary">4. Data Orang Tua</h5>
                </div>
                <div class="card-body p-4">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label fw-bold">{{ form.father_name.label.text }} <span class="text-danger">*</span></label>
                            {{ form.father_name(class="form-control") }}

                            <div class="mt-2">
                                <label class="form-label small">Pekerjaan</label>
                                {{ form.father_job(class="form-control form-control-sm") }}
                                <label class="form-label small mt-1">Penghasilan</label>
                                {{ form.father_income_range(class="form-select form-select-sm") }}
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label fw-bold">{{ form.mother_name.label.text }} <span class="text-danger">*</span></label>
                            {{ form.mother_name(class="form-control") }}

                            <div class="mt-2">
                                <label class="form-label small">Pekerjaan</label>
                                {{ form.mother_job(class="form-control form-control-sm") }}
                                <label class="form-label small mt-1">Penghasilan</label>
                                {{ form.mother_income_range(class="form-select form-select-sm") }}
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-bold">{{ form.parent_phone.label.text }} <span class="text-danger">*</span></label>
                        {{ form.parent_phone(class="form-control bg-light", placeholder="08xxxxxxxxxx") }}
                        <small class="text-muted">Nomor WhatsApp Orang Tua</small>
                    </div>
                </div>
            </div>

            <!-- STEP 5: Khusus RQDF Sore (Hidden untuk Majelis) -->
            <div class="card shadow-sm border-0 mb-4" id="rqdf_options" style="display: none;">
                <div class="card-header bg-white py-3">
                    <h5 class="m-0 fw-bold text-primary">5. Pilihan Khusus RQDF Sore</h5>
                </div>
                <div class="card-body p-4">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label fw-bold">{{ form.tahfidz_schedule.label.text }}</label>
                            {{ form.tahfidz_schedule(class="form-select") }}
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label fw-bold">{{ form.uniform_size.label.text }}</label>
                            {{ form.uniform_size(class="form-select") }}
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold">{{ form.initial_pledge_amount.label.text }}</label>
                        {{ form.initial_pledge_amount(class="form-select") }}
                    </div>
                </div>
            </div>

            <!-- Submit Button -->
            <div class="card shadow-sm border-0 mb-4">
                <div class="card-body text-center p-4">
                    <div class="form-check mb-3" id="agreement_section">
                        {{ form.finance_agreement(class="form-check-input") }}
                        <label class="form-check-label" for="finance_agreement">
                            Saya telah membaca dan menyetujui ketentuan di atas
                        </label>
                    </div>
                    {{ form.submit(class="btn btn-primary btn-lg px-5") }}
                </div>
            </div>
        </form>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const programSelector = document.getElementById('programSelector');
    const majlisInfo = document.getElementById('majlis_info');
    const majlisPersonalData = document.getElementById('majlis_personal_data');
    const parentData = document.getElementById('parent_data');
    const educationBackground = document.getElementById('education_background');
    const rqdfOptions = document.getElementById('rqdf_options');
    const agreementSection = document.getElementById('agreement_section');
    const formalOptions = document.getElementById('group_formal_options');
    const optionalData = document.getElementById('optional_data');

    function toggleMajlisFields() {
        const selectedProgram = programSelector.value;
        const isMajlis = selectedProgram === 'MAJLIS_TALIM';
        const isRQDF = selectedProgram === 'RQDF_SORE';

        // Show/hide elements based on program
        majlisInfo.style.display = isMajlis ? 'block' : 'none';
        majlisPersonalData.style.display = isMajlis ? 'block' : 'none';
        parentData.style.display = isMajlis ? 'none' : 'block';
        educationBackground.style.display = isMajlis ? 'none' : 'block';
        rqdfOptions.style.display = isRQDF ? 'block' : 'none';
        formalOptions.style.display = isMajlis ? 'none' : 'block';
        optionalData.style.display = isMajlis ? 'none' : 'block';

        // Update required fields
        if (isMajlis) {
            // Make majlis fields required
            const personalJobField = document.querySelector('[name="personal_job"]');
            if (personalJobField) personalJobField.required = true;

            // Remove requirements from parent fields
            const fatherNameField = document.querySelector('[name="father_name"]');
            const motherNameField = document.querySelector('[name="mother_name"]');
            const previousSchoolField = document.querySelector('[name="previous_school"]');

            if (fatherNameField) fatherNameField.required = false;
            if (motherNameField) motherNameField.required = false;
            if (previousSchoolField) previousSchoolField.required = false;

            // Change agreement text
            const agreementLabel = agreementSection.querySelector('label');
            if (agreementLabel) {
                agreementLabel.textContent = 'Saya bersedia mengikuti kegiatan Majelis Ta\'lim sesuai jadwal yang ditentukan';
            }

        } else {
            // Restore normal requirements for student programs
            const personalJobField = document.querySelector('[name="personal_job"]');
            if (personalJobField) personalJobField.required = false;

            const fatherNameField = document.querySelector('[name="father_name"]');
            const motherNameField = document.querySelector('[name="mother_name"]');
            const previousSchoolField = document.querySelector('[name="previous_school"]');

            if (fatherNameField) fatherNameField.required = true;
            if (motherNameField) motherNameField.required = true;
            if (previousSchoolField) previousSchoolField.required = true;

            // Restore normal agreement text
            const agreementLabel = agreementSection.querySelector('label');
            if (agreementLabel) {
                agreementLabel.textContent = 'Saya telah membaca dan menyetujui rincian biaya pendidikan di atas';
            }
        }
    }

    programSelector.addEventListener('change', toggleMajlisFields);
    toggleMajlisFields(); // Initial call
});
</script>
{% endblock %}